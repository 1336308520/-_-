[toc]

# SQL语言概述

## SQL语言分类

- **数据定义语言 DDL**

  - alter、drop、create

- **数据查询语言 DQL**

  - select

- **数据操纵语言 DML**

  - insert、updadte、delete

- **事务控制语言 TCL**

  

# 事务控制

- ## 事务开始

  - 第一个DML（insert、updat、delete）执行时，事务开始

- ## 事务结束

  - 执行commit（事务提交）或rollback（事务回滚）
  - 执行一条DDL语句（如create table）时，会自动提交事务。
  - 使用exit命令正常退出sql*plus时，会自动执行commit。如果sql\*plus被意外终止，则自动执行rollback。

## 事务四个特性ACID

- **原子性**
- 事务是原子的，事务中包含的所有SQL语句组成一个不可分割的工作单元。

- **一致性**
- 事务执行的结果必须是使数据库从一个一致性状态转入另一个一致性状态，不存在中间状态。

- **隔离性**
- 数据库中一个事务的执行不受其他事务的干扰。

- **持久性**
- 一个事务一旦提交，对数据库中数据的改变是永久的。

# 并发事务

## 并发事务可能导致的三类问题

- **脏读**
  - 一个事务对数据的修改在提交之前被其他事务读取。
- **不可重复读**
  - 在某个事务读取一次数据后，其他事务修改了这些数据并进行了提交，当该事务重新读取这些数据时就会得到与前一次不一样的结果。
- **幻读**
  - 同一查询在同一事务中多次进行，由于其他事务所做的插入或删除操作，每次返回不同的结果。

## 事务的隔离级别

- READ UNCOMMITED （未授权读取或读未提交）
  - 表示即使一个更新操作的事务没有提交，其他事务仍然可以读取到改变的数据。
    - 脏读、不可重读、幻读问题都存在
- READ COMMITED（授权读取或读提交）
  - 表示一个更新操作的是事务提交后，其他事务才能读取到改变的数据。
    - 解决了脏读问题
- REPEATABLE READ（可重复读取）
  - 表示同一个事务里面先后执行同一个查询语句时，得到的结果集相同。
    - 解决了脏读和不可重复读
- SERIALIZABLE（序列化）
  - 要求事务序列化执行，即事务不能并发执行。
    - 解决所有问题

## 设置事务隔离级别

- set transaction isolation level read commited;

  

## 修改事务隔离级别

- alter session set isolation_level = read commited;